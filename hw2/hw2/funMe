#!/bin/bash

#flex hw1.lex
#gcc -ll lex.yy.c
make

tests_won=0
tests_lost=0
seif_tests_lost=0
NORMAL_TEST=0
SEIF_TEST=1

function compareFiles {
file=$1
exe="./hw2"
flag=$NORMAL_TEST
if [[ $file == "Seif"* ]]; then
	seif_name=`echo $file | cut -c5-`
	$exe -$seif_name >& "ActualResult/Seif$seif_name.res"
	flag=$SEIF_TEST
else
	#$exe < "Input/$file.in" >& "ExpectedResult/$file.out"
	$exe < "Input/$file.in" >& "ActualResult/$file.res"
fi
diff "ActualResult/$file.res" "ExpectedResult/$file.out"
DIFF=$(diff "ActualResult/$file.res" "ExpectedResult/$file.out")
if [[ "$DIFF" != "" ]]; then #If true, then test$i.res and test$i.out are different files :(
	let tests_lost++
	echo "You have failed in the folowing test: $file :(" 
	if (( $flag == $SEIF_TEST));then
		let seif_tests_lost++
	fi
else
	let tests_won++
fi
}

function printSummary {
if(( $tests_lost == 0 )); then
	total_tests=$(($tests_won + $tests_lost))
	echo "You passed all $total_tests tests :), congratulations!!!"
	echo "You are now an expert LL(1) Doctor, share the good news :)"
else
	echo "You passed $tests_won tests, but failed in $tests_lost"
	if (( $seif_tests_lost > 0 )); then
		echo "You failed in $seif_tests_lost SEIF tests (Seifnullable,Seiffirst,Seiffollow or Seifselect)."
		echo "please consult a LL(1) doctor :D , Pages 16,17 and and 24 contain tips"
	else
		echo "You passed all SEIFS up to LL(1) Doctor, please help him using the algorithm in page 37 (Tutorial 2)"
		echo "Also , make sure your lexical evaluation of tokens ( update to return INDEX ) + error (A B C) operates "
		echo "like in hw1..."
	fi
fi
}

compareFiles "Seifnullable"
compareFiles "Seiffirst"
compareFiles "Seiffollow"
compareFiles "Seifselect"
# These 2 tests are credited to teacher in charge
compareFiles "t1"
compareFiles "t2"
# My new additions that should cover all possible cuts by our LL(1) Doctor :)
compareFiles "EmptyStruct"
compareFiles "EmptyStructWithComment"
compareFiles "EmptyList"
compareFiles "EmptyListWithComment"
compareFiles "EmptyMap"
compareFiles "EmptyMapWithComment"
compareFiles "DereferenceSyntaxError"
compareFiles "DeclarationSyntaxError"
compareFiles "IntegerSyntaxError"
compareFiles "EmptyFileSyntaxError"
compareFiles "DoctorLL(1)WentHome"
compareFiles "MostRulesTogether"
compareFiles "DoctorLL(1)CombatsSyntaxError"
compareFiles "DoctorLL(1)CombatsErrorChar"
compareFiles "DoctorLL(1)CombatsUnclosedString"
compareFiles "DoctorLL(1)CombatsUndefinedEscape"

# These are the old tests from hw1, instead of removing them, it's better to use them to compare desired outputs...
# Besides, in case of a lexical error, there should be an agreement on what's a lexical error and also how to treat comments...
compareFiles "EmptyFile"
compareFiles "IgnoreSpaces"
compareFiles "IgnoreTabs"
compareFiles "IgnoreNewLine"
compareFiles "IgnoreCarriage"
compareFiles "IgnoreCarriageFollowedByNewLine"
compareFiles "IgnoreMix"
compareFiles "StructBasic"
compareFiles "StructOppositeBasic"
compareFiles "ItemBasic"
compareFiles "StructThenItem"
compareFiles "DoubleStructThenItem"
compareFiles "List"
compareFiles "Dict"
compareFiles "FourtyTwoKeys"
compareFiles "ThreeComplexKeys"
compareFiles "EightCommas"
compareFiles "AllTypes"
compareFiles "CommentBasic"
compareFiles "CommentAdvanced"
compareFiles "CommentOnly"
compareFiles "TrueBasic"
compareFiles "FalseBasic"
compareFiles "TrueOrFalse"
compareFiles "IntegerDecimalBasic"
compareFiles "IntegerDecimalOnePlusOne"
compareFiles "IntegerDecimalMoreThanOneWayToDefineZero"
compareFiles "IntegerHexaBasic"
compareFiles "IntegerHexaFace"
compareFiles "IntegerOctalBasic"
compareFiles "IntegerMix"
compareFiles "RealDecimalBasic"
compareFiles "RealDecimalAdvanced"
compareFiles "RealDecimalThenStructThenIntegerDecimal"
compareFiles "RealExponentBasic"
compareFiles "RealExponentThenRealDecimal"
compareFiles "InfinityBasic"
compareFiles "NotANumber"
compareFiles "DeclarationAvengersFour"
compareFiles "Dereference"
compareFiles "Val"
compareFiles "StringBasic"
compareFiles "StringCancelsAString"
compareFiles "StringAdvanced" # Fixed again at 6/4
compareFiles "Dollar"
compareFiles "HexaCanLie"
compareFiles "StringIsSad"
compareFiles "StringIsSadVersionTwo"
compareFiles "LetterQTriedToEscapeFromPrison"
compareFiles "TimeEscapeInHexa"
compareFiles "StringNotClosed" # New since 6/4
compareFiles "StringIsOkay" # New since 6/4
compareFiles "StringTwoEscapesInARow" # New since 6/4
compareFiles "StringIllegalSequenceBeforeUnclosed" # New since 6/4
#compareFiles "AsciiStringA0"
compareFiles "AsciiStringA1"
compareFiles "AsciiStringA2"
compareFiles "AsciiStringA3"
compareFiles "AsciiStringA4"
compareFiles "AsciiStringA5"
compareFiles "AsciiStringA6"
compareFiles "AsciiStringA7"
compareFiles "AsciiStringA8"
compareFiles "AsciiStringA9"
compareFiles "AsciiStringA10"
compareFiles "AsciiStringA11"
compareFiles "AsciiStringA12"
compareFiles "AsciiStringA13"
compareFiles "AsciiStringA14"
compareFiles "AsciiStringA15"
compareFiles "AsciiStringA16"
compareFiles "AsciiStringA17"
compareFiles "AsciiStringA18"
compareFiles "AsciiStringA19"
compareFiles "AsciiStringA20"
compareFiles "AsciiStringA21"
compareFiles "AsciiStringA22"
compareFiles "AsciiStringA23"
compareFiles "AsciiStringA24"
compareFiles "AsciiStringA25"
compareFiles "AsciiStringA26"
compareFiles "AsciiStringA27"
compareFiles "AsciiStringA28"
compareFiles "AsciiStringA29"
compareFiles "AsciiStringA30"
compareFiles "AsciiStringA31"
compareFiles "AsciiStringA32"
compareFiles "AsciiStringA33"
compareFiles "AsciiStringA34"
compareFiles "AsciiStringA35"
compareFiles "AsciiStringA36"
compareFiles "AsciiStringA37"
compareFiles "AsciiStringA38"
compareFiles "AsciiStringA39"
compareFiles "AsciiStringA40"
compareFiles "AsciiStringA41"
compareFiles "AsciiStringA42"
compareFiles "AsciiStringA43"
compareFiles "AsciiStringA44"
compareFiles "AsciiStringA45"
compareFiles "AsciiStringA46"
compareFiles "AsciiStringA47"
compareFiles "AsciiStringA48"
compareFiles "AsciiStringA49"
compareFiles "AsciiStringA50"
compareFiles "AsciiStringA51"
compareFiles "AsciiStringA52"
compareFiles "AsciiStringA53"
compareFiles "AsciiStringA54"
compareFiles "AsciiStringA55"
compareFiles "AsciiStringA56"
compareFiles "AsciiStringA57"
compareFiles "AsciiStringA58"
compareFiles "AsciiStringA59"
compareFiles "AsciiStringA60"
compareFiles "AsciiStringA61"
compareFiles "AsciiStringA62"
compareFiles "AsciiStringA63"
compareFiles "AsciiStringA64"
compareFiles "AsciiStringA65"
compareFiles "AsciiStringA66"
compareFiles "AsciiStringA67"
compareFiles "AsciiStringA68"
compareFiles "AsciiStringA69"
compareFiles "AsciiStringA70"
compareFiles "AsciiStringA71"
compareFiles "AsciiStringA72"
compareFiles "AsciiStringA73"
compareFiles "AsciiStringA74"
compareFiles "AsciiStringA75"
compareFiles "AsciiStringA76"
compareFiles "AsciiStringA77"
compareFiles "AsciiStringA78"
compareFiles "AsciiStringA79"
compareFiles "AsciiStringA80"
compareFiles "AsciiStringA81"
compareFiles "AsciiStringA82"
compareFiles "AsciiStringA83"
compareFiles "AsciiStringA84"
compareFiles "AsciiStringA85"
compareFiles "AsciiStringA86"
compareFiles "AsciiStringA87"
compareFiles "AsciiStringA88"
compareFiles "AsciiStringA89"
compareFiles "AsciiStringA90"
compareFiles "AsciiStringA91"
compareFiles "AsciiStringA92"
compareFiles "AsciiStringA93"
compareFiles "AsciiStringA94"
compareFiles "AsciiStringA95"
compareFiles "AsciiStringA96"
compareFiles "AsciiStringA97"
compareFiles "AsciiStringA98"
compareFiles "AsciiStringA99"
compareFiles "AsciiStringA100"
compareFiles "AsciiStringA101"
compareFiles "AsciiStringA102"
compareFiles "AsciiStringA103"
compareFiles "AsciiStringA104"
compareFiles "AsciiStringA105"
compareFiles "AsciiStringA106"
compareFiles "AsciiStringA107"
compareFiles "AsciiStringA108"
compareFiles "AsciiStringA109"
compareFiles "AsciiStringA110"
compareFiles "AsciiStringA111"
compareFiles "AsciiStringA112"
compareFiles "AsciiStringA113"
compareFiles "AsciiStringA114"
compareFiles "AsciiStringA115"
compareFiles "AsciiStringA116"
compareFiles "AsciiStringA117"
compareFiles "AsciiStringA118"
compareFiles "AsciiStringA119"
compareFiles "AsciiStringA120"
compareFiles "AsciiStringA121"
compareFiles "AsciiStringA122"
compareFiles "AsciiStringA123"
compareFiles "AsciiStringA124"
compareFiles "AsciiStringA125"
compareFiles "AsciiStringA126"
compareFiles "AsciiStringA127"
#compareFiles "AsciiStringB0"
compareFiles "AsciiStringB1"
compareFiles "AsciiStringB2"
compareFiles "AsciiStringB3"
compareFiles "AsciiStringB4"
compareFiles "AsciiStringB5"
compareFiles "AsciiStringB6"
compareFiles "AsciiStringB7"
compareFiles "AsciiStringB8"
compareFiles "AsciiStringB9"
compareFiles "AsciiStringB10"
compareFiles "AsciiStringB11"
compareFiles "AsciiStringB12"
compareFiles "AsciiStringB13"
compareFiles "AsciiStringB14"
compareFiles "AsciiStringB15"
compareFiles "AsciiStringB16"
compareFiles "AsciiStringB17"
compareFiles "AsciiStringB18"
compareFiles "AsciiStringB19"
compareFiles "AsciiStringB20"
compareFiles "AsciiStringB21"
compareFiles "AsciiStringB22"
compareFiles "AsciiStringB23"
compareFiles "AsciiStringB24"
compareFiles "AsciiStringB25"
compareFiles "AsciiStringB26"
compareFiles "AsciiStringB27"
compareFiles "AsciiStringB28"
compareFiles "AsciiStringB29"
compareFiles "AsciiStringB30"
compareFiles "AsciiStringB31"
compareFiles "AsciiStringB32"
compareFiles "AsciiStringB33"
compareFiles "AsciiStringB34"
compareFiles "AsciiStringB35"
compareFiles "AsciiStringB36"
compareFiles "AsciiStringB37"
compareFiles "AsciiStringB38"
compareFiles "AsciiStringB39"
compareFiles "AsciiStringB40"
compareFiles "AsciiStringB41"
compareFiles "AsciiStringB42"
compareFiles "AsciiStringB43"
compareFiles "AsciiStringB44"
compareFiles "AsciiStringB45"
compareFiles "AsciiStringB46"
compareFiles "AsciiStringB47"
compareFiles "AsciiStringB48"
compareFiles "AsciiStringB49"
compareFiles "AsciiStringB50"
compareFiles "AsciiStringB51"
compareFiles "AsciiStringB52"
compareFiles "AsciiStringB53"
compareFiles "AsciiStringB54"
compareFiles "AsciiStringB55"
compareFiles "AsciiStringB56"
compareFiles "AsciiStringB57"
compareFiles "AsciiStringB58"
compareFiles "AsciiStringB59"
compareFiles "AsciiStringB60"
compareFiles "AsciiStringB61"
compareFiles "AsciiStringB62"
compareFiles "AsciiStringB63"
compareFiles "AsciiStringB64"
compareFiles "AsciiStringB65"
compareFiles "AsciiStringB66"
compareFiles "AsciiStringB67"
compareFiles "AsciiStringB68"
compareFiles "AsciiStringB69"
compareFiles "AsciiStringB70"
compareFiles "AsciiStringB71"
compareFiles "AsciiStringB72"
compareFiles "AsciiStringB73"
compareFiles "AsciiStringB74"
compareFiles "AsciiStringB75"
compareFiles "AsciiStringB76"
compareFiles "AsciiStringB77"
compareFiles "AsciiStringB78"
compareFiles "AsciiStringB79"
compareFiles "AsciiStringB80"
compareFiles "AsciiStringB81"
compareFiles "AsciiStringB82"
compareFiles "AsciiStringB83"
compareFiles "AsciiStringB84"
compareFiles "AsciiStringB85"
compareFiles "AsciiStringB86"
compareFiles "AsciiStringB87"
compareFiles "AsciiStringB88"
compareFiles "AsciiStringB89"
compareFiles "AsciiStringB90"
compareFiles "AsciiStringB91"
compareFiles "AsciiStringB92"
compareFiles "AsciiStringB93"
compareFiles "AsciiStringB94"
compareFiles "AsciiStringB95"
compareFiles "AsciiStringB96"
compareFiles "AsciiStringB97"
compareFiles "AsciiStringB98"
compareFiles "AsciiStringB99"
compareFiles "AsciiStringB100"
compareFiles "AsciiStringB101"
compareFiles "AsciiStringB102"
compareFiles "AsciiStringB103"
compareFiles "AsciiStringB104"
compareFiles "AsciiStringB105"
compareFiles "AsciiStringB106"
compareFiles "AsciiStringB107"
compareFiles "AsciiStringB108"
compareFiles "AsciiStringB109"
compareFiles "AsciiStringB110"
compareFiles "AsciiStringB111"
compareFiles "AsciiStringB112"
compareFiles "AsciiStringB113"
compareFiles "AsciiStringB114"
compareFiles "AsciiStringB115"
compareFiles "AsciiStringB116"
compareFiles "AsciiStringB117"
compareFiles "AsciiStringB118"
compareFiles "AsciiStringB119"
compareFiles "AsciiStringB120"
compareFiles "AsciiStringB121"
compareFiles "AsciiStringB122"
compareFiles "AsciiStringB123"
compareFiles "AsciiStringB124"
compareFiles "AsciiStringB125"
compareFiles "AsciiStringB126"
compareFiles "AsciiStringB127"
#compareFiles "StringARights"
#compareFiles "StringBRights"
compareFiles "CommentRights"
compareFiles "Rights"
compareFiles "VerticalTabIsIllegal"
# added by Natan
compareFiles "NewlineInSingleQuotes" 
compareFiles "EscapeSequenceInComment"
compareFiles "ShortSingleString"
compareFiles "NonPrintable"
compareFiles "NonPrintable2"
# added by Uriel and Yakir
compareFiles "uyt1"
compareFiles "uyt2"
compareFiles "uyt3"
compareFiles "uyt4"
compareFiles "uyt5"
compareFiles "uyt6"
compareFiles "uyt7"
compareFiles "uyt8"
compareFiles "uyt9"

printSummary
